<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„Ø°ÙŠØ¨ | Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #e67e22;
            --green-color: #27ae60;
            --red-color: #c0392b;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: #333;
            padding-bottom: 80px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo h1 { margin: 0; font-size: 1.5rem; }
        .logo p { margin: 0; font-size: 0.8rem; opacity: 0.8; }

        .cart-icon-container { position: relative; cursor: pointer; font-size: 1.5rem; }
        .cart-badge {
            position: absolute; top: -8px; right: -10px;
            background-color: var(--accent-color); color: white;
            border-radius: 50%; padding: 4px 8px; font-size: 0.8rem; font-weight: bold;
        }

        .category-nav {
            background: #fff; padding: 10px; overflow-x: auto; white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 70px; z-index: 99;
        }

        .cat-btn {
            display: inline-block; background: #f0f0f0; padding: 8px 16px;
            border-radius: 20px; margin-left: 10px; cursor: pointer; transition: 0.3s;
        }
        .cat-btn.active { background: var(--primary-color); color: white; }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }

        .products-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px;
        }

        .product-card {
            background: var(--card-bg); border-radius: 12px; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; position: relative;
        }

        .product-card.inactive {
            opacity: 0.7;
            filter: grayscale(1);
            border: 2px dashed #999;
            background-color: #f0f0f0;
        }
        .product-card.inactive .add-btn {
            background-color: #999;
            pointer-events: none;
        }

        .discount-badge {
            position: absolute; top: 10px; right: 10px; background-color: var(--red-color);
            color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;
        }
        
        .inactive-badge {
            position: absolute; top: 10px; left: 10px; background-color: #333;
            color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;
            z-index: 2;
        }

        .product-image { width: 100%; height: 150px; object-fit: cover; background-color: #eee; }
        .product-info { padding: 10px; display: flex; flex-direction: column; flex-grow: 1; }
        .product-title { font-size: 1rem; font-weight: bold; margin-bottom: 5px; }
        .product-desc { font-size: 0.8rem; color: #666; margin-bottom: 10px; flex-grow: 1; }
        .product-footer { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 10px; }
        
        .price-old { text-decoration: line-through; color: #999; font-size: 0.8rem; }
        .price-new { font-weight: bold; color: var(--primary-color); font-size: 1.1rem; }
        .price-new.has-discount { color: var(--red-color); }

        .add-btn {
            background-color: var(--primary-color); color: white; border: none;
            padding: 6px 12px; border-radius: 6px; cursor: pointer; transition: 0.2s;
        }
        .add-btn:active { transform: scale(0.95); }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: flex-end; }
        @media (min-width: 768px) { .modal { align-items: center; } .modal-content { width: 400px; border-radius: 15px; height: auto; max-height: 85vh; } }
        .modal-content { background-color: #fff; width: 100%; height: 90vh; border-radius: 20px 20px 0 0; padding: 20px; display: flex; flex-direction: column; animation: slideUp 0.3s; }
        @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
        .cart-items-container { flex-grow: 1; overflow-y: auto; margin-bottom: 15px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0; }
        .item-controls button { background: #eee; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-weight: bold; }
        .cart-summary { background: #f9f9f9; padding: 15px; border-radius: 10px; }
        .total-row { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; }
        .checkout-btn { width: 100%; background-color: var(--green-color); color: white; border: none; padding: 15px; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; }
        input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: inherit; }
        .fab { position: fixed; bottom: 20px; left: 20px; background-color: var(--accent-color); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; z-index: 90; }

        .admin-toggle {
            text-align: center; margin: 30px 0;
        }
        .admin-toggle button {
            background: #ddd; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; color: #555;
        }
        .section-title {
            margin: 20px 0 10px 0; padding: 0 10px; font-size: 1.2rem; color: #666; border-bottom: 1px solid #eee; padding-bottom: 5px;
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <h1>Ù…ØªØ¬Ø± Ø§Ù„Ø°ÙŠØ¨ ğŸº</h1>
            <p>Ø£Ø¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©</p>
        </div>
        <div class="cart-icon-container" onclick="openCart()">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-badge" class="cart-badge">0</span>
        </div>
    </header>

    <div id="category-nav" class="category-nav" style="display:none;"></div>

    <div class="container">
        <div id="loading" style="text-align:center; padding:50px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª... â³</div>
        
        <div id="products-grid" class="products-grid"></div>

        <div class="admin-toggle" id="inactive-toggle" style="display:none;">
            <button onclick="toggleInactive()">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø© / Ø§Ù„Ù…Ø®ÙÙŠØ©</button>
        </div>

        <div id="inactive-section" style="display:none;">
            <div class="section-title">â›” Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ù†Ø´Ø·Ø© / Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©</div>
            <div id="inactive-grid" class="products-grid"></div>
        </div>
    </div>

    <div class="fab" onclick="openCart()">
        <i class="fas fa-shopping-basket"></i>
    </div>

    <div id="cartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ğŸ›’</h3>
                <span onclick="closeCart()" style="cursor:pointer; font-size:1.5rem;">&times;</span>
            </div>
            <div id="cart-items" class="cart-items-container">
                <p style="text-align:center; color:#999; margin-top:50px;">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
            </div>
            <div class="cart-summary" id="cart-summary" style="display:none;">
                <div class="total-row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span id="cart-total">0 $</span></div>
                <hr style="margin: 10px 0; border:0; border-top:1px solid #ddd;">
                <input type="text" id="cust-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…">
                <textarea id="cust-address" rows="2" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„"></textarea>
                <button class="checkout-btn" onclick="checkout()"><i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://sheetdb.io/api/v1/0flk7iaw3nr0g';
        const PHONE = '4917623456589'; 
        let cart = JSON.parse(localStorage.getItem('altheeb_cart')) || [];
        let productsData = [];
        let activeCategory = 'Ø§Ù„ÙƒÙ„';

        // --- Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…Ø­Ø³Ù†Ø©: ØªØ³ØªØ®Ø¯Ù… Ø±Ø§Ø¨Ø· Thumbnail Ø§Ù„Ø³Ø±ÙŠØ¹ ÙˆØ§Ù„Ù…Ø¶Ù…ÙˆÙ† ---
        function convertDriveLink(url) {
            if (!url) return null;
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ
            if (url.includes('drive.google.com')) {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ø±Ù Ø§Ù„ØµÙˆØ±Ø© (ID)
                const idMatch = url.match(/\/d\/(.*?)\/|id=(.*?)(&|$)/);
                if (idMatch) {
                    const id = idMatch[1] || idMatch[2];
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· thumbnail Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¬Ù… (w1000 ÙŠØ¹Ù†ÙŠ Ø¹Ø±Ø¶ 1000 Ø¨ÙƒØ³Ù„)
                    // Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØªØ¬Ø§ÙˆØ² Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø­Ø¸Ø± ÙˆÙŠØ¹Ù…Ù„ Ø¨Ø³Ø±Ø¹Ø©
                    return `https://drive.google.com/thumbnail?id=${id}&sz=w1000`;
                }
            }
            return url;
        }

        function cleanDataKeys(data) {
            return data.map(item => {
                const newItem = {};
                Object.keys(item).forEach(key => {
                    const cleanKey = key.trim().toLowerCase();
                    newItem[cleanKey] = item[key];
                });
                return newItem;
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            updateCartCount();
            fetch(API_URL)
                .then(res => res.json())
                .then(rawData => {
                    const data = cleanDataKeys(rawData);
                    productsData = data.filter(p => p.name && p.name.trim() !== '');
                    document.getElementById('loading').style.display = 'none';
                    renderCategories(productsData);
                    renderAllProducts(productsData);
                })
                .catch(err => {
                    document.getElementById('loading').innerHTML = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
                    console.error(err);
                });
        });

        function renderAllProducts(products) {
            let filtered = products;
            if (activeCategory !== 'Ø§Ù„ÙƒÙ„') {
                filtered = products.filter(p => p.category && p.category.trim() === activeCategory);
            }

            const activeProducts = [];
            const inactiveProducts = [];

            filtered.forEach(p => {
                let status = p.aktive || p.active || 'no';
                status = status.toString().trim().toLowerCase();
                
                if (status === 'yes' || status === 'true' || status === '1' || status === 'Ù†Ø¹Ù…') {
                    activeProducts.push(p);
                } else {
                    inactiveProducts.push(p);
                }
            });

            renderGrid('products-grid', activeProducts, false);

            const inactiveContainer = document.getElementById('inactive-section');
            const toggleBtn = document.getElementById('inactive-toggle');
            
            if (inactiveProducts.length > 0) {
                toggleBtn.style.display = 'block';
                renderGrid('inactive-grid', inactiveProducts, true);
            } else {
                toggleBtn.style.display = 'none';
                inactiveContainer.style.display = 'none';
            }
        }

        function renderGrid(containerId, products, isInactive) {
            const grid = document.getElementById(containerId);
            grid.innerHTML = '';

            if (products.length === 0 && !isInactive) {
                grid.innerHTML = '<p style="text-align:center; width:100%; grid-column:1/-1;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù†Ø´Ø·Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p>';
                return;
            }

            products.forEach(p => {
                let originalPrice = parseFloat(p.price);
                let discountVal = p.discaount || p.discount || 0;
                let discountPercent = parseFloat(discountVal);
                let finalPrice = originalPrice;
                let hasDiscount = false;

                if (discountPercent > 0) {
                    finalPrice = originalPrice - (originalPrice * discountPercent / 100);
                    hasDiscount = true;
                }

                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·
                const imgSrc = convertDriveLink(p.image) || 'https://via.placeholder.com/150';
                
                let priceHTML = '';
                if (hasDiscount) {
                    priceHTML = `<div class="price-container"><span class="price-old">${originalPrice} $</span><span class="price-new has-discount">${finalPrice.toFixed(2)} $</span></div>`;
                } else {
                    priceHTML = `<div class="price-container"><span class="price-new">${originalPrice} $</span></div>`;
                }

                let badgeHTML = hasDiscount ? `<div class="discount-badge">Ø®ØµÙ… ${discountPercent}%</div>` : '';
                
                let cardClass = isInactive ? 'product-card inactive' : 'product-card';
                let inactiveBadge = isInactive ? '<div class="inactive-badge">ØºÙŠØ± Ù…ØªÙˆÙØ±</div>' : '';
                let btnState = isInactive ? 'disabled' : '';
                let btnText = isInactive ? 'Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©' : '<i class="fas fa-plus"></i> Ø£Ø¶Ù';
                let btnClick = isInactive ? '' : `onclick="addToCart('${p.id || p.name}')"`;

                // ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© referrerpolicy="no-referrer" Ù„Ù…Ù†Ø¹ Ø­Ø¸Ø± Ø¬ÙˆØ¬Ù„
                grid.innerHTML += `
                    <div class="${cardClass}">
                        ${badgeHTML}
                        ${inactiveBadge}
                        <img src="${imgSrc}" class="product-image" loading="lazy" alt="${p.name}" referrerpolicy="no-referrer">
                        <div class="product-info">
                            <div class="product-title">${p.name}</div>
                            <div class="product-desc">${p.description || ''}</div>
                            <div class="product-footer">
                                ${priceHTML}
                                <button class="add-btn" ${btnClick} ${btnState}>
                                    ${btnText}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function toggleInactive() {
            const section = document.getElementById('inactive-section');
            if (section.style.display === 'none') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        function renderCategories(products) {
            const nav = document.getElementById('category-nav');
            const rawCategories = products.map(p => p.category);
            const uniqueCategories = [...new Set(rawCategories.filter(c => c && c.trim() !== ''))];

            if (uniqueCategories.length > 0) {
                nav.style.display = 'block';
                nav.innerHTML = '';
                const allBtn = document.createElement('span');
                allBtn.className = 'cat-btn active';
                allBtn.innerText = 'Ø§Ù„ÙƒÙ„';
                allBtn.onclick = () => filterProducts('Ø§Ù„ÙƒÙ„', allBtn);
                nav.appendChild(allBtn);
                uniqueCategories.forEach(cat => {
                    const btn = document.createElement('span');
                    btn.className = 'cat-btn';
                    btn.innerText = cat;
                    btn.onclick = () => filterProducts(cat, btn);
                    nav.appendChild(btn);
                });
            }
        }

        function filterProducts(category, btnElement) {
            activeCategory = category;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');
            renderAllProducts(productsData);
        }

        function addToCart(identifier) {
            const product = productsData.find(p => (p.id || p.name) == identifier);
            let originalPrice = parseFloat(product.price);
            let discountVal = product.discaount || product.discount || 0;
            let discountPercent = parseFloat(discountVal);
            let finalPrice = originalPrice;
            let hasDiscount = false;
            if (discountPercent > 0) { finalPrice = originalPrice - (originalPrice * discountPercent / 100); hasDiscount = true; }
            const existingItem = cart.find(item => item.name === product.name);
            if (existingItem) { existingItem.qty++; } else { cart.push({ name: product.name, originalPrice: originalPrice, price: parseFloat(finalPrice.toFixed(2)), hasDiscount: hasDiscount, qty: 1 }); }
            saveCart(); updateCartCount();
            const btn = event.target.closest('button');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i>'; btn.style.background = '#27ae60';
            setTimeout(() => { btn.innerHTML = originalHTML; btn.style.background = '#2c3e50'; }, 1000);
        }
        function saveCart() { localStorage.setItem('altheeb_cart', JSON.stringify(cart)); renderCartItems(); }
        function updateCartCount() { const count = cart.reduce((acc, item) => acc + item.qty, 0); document.getElementById('cart-badge').innerText = count; }
        function changeQty(name, change) { const item = cart.find(i => i.name === name); if (item) { item.qty += change; if (item.qty <= 0) { cart = cart.filter(i => i.name !== name); } saveCart(); } }
        function renderCartItems() {
            const container = document.getElementById('cart-items'); const summary = document.getElementById('cart-summary');
            if (cart.length === 0) { container.innerHTML = '<p style="text-align:center; color:#999; margin-top:50px;">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© ğŸ›’</p>'; summary.style.display = 'none'; return; }
            summary.style.display = 'block'; let html = ''; let total = 0;
            cart.forEach(item => {
                let itemTotal = item.price * item.qty; total += itemTotal;
                let priceDisplay = item.hasDiscount ? `<span style="text-decoration:line-through; color:#999; font-size:0.8rem;">${item.originalPrice}</span> <span style="color:#c0392b; font-weight:bold;">${item.price} $</span>` : `<span>${item.price} $</span>`;
                html += `<div class="cart-item"><div><div style="font-weight:bold;">${item.name}</div><div style="font-size:0.85rem; margin-top:4px;">${priceDisplay} Ã— ${item.qty}</div></div><div class="item-controls" style="display:flex; align-items:center; gap:10px;"><button onclick="changeQty('${item.name}', -1)">-</button><span>${item.qty}</span><button onclick="changeQty('${item.name}', 1)">+</button></div></div>`;
            });
            container.innerHTML = html; document.getElementById('cart-total').innerText = total.toFixed(2) + ' $';
        }
        function openCart() { renderCartItems(); document.getElementById('cartModal').style.display = 'flex'; }
        function closeCart() { document.getElementById('cartModal').style.display = 'none'; }
        function checkout() {
            const name = document.getElementById('cust-name').value; const address = document.getElementById('cust-address').value;
            if (!name || cart.length === 0) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª'); return; }
            let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…ØªØ¬Ø± Ø§Ù„Ø°ÙŠØ¨ ğŸº*\n--------------------------------\nğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\nğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}\n--------------------------------\nğŸ“‹ *Ø§Ù„Ø·Ù„Ø¨Ø§Øª:*\n\n`;
            let total = 0; let savedAmount = 0;
            cart.forEach(item => {
                let lineTotal = item.price * item.qty; total += lineTotal;
                let priceString = item.hasDiscount ? `~${item.originalPrice}$~ ${item.price}$` : `${item.price}$`;
                if(item.hasDiscount) savedAmount += (item.originalPrice - item.price) * item.qty;
                msg += `â–ªï¸ ${item.name}\n   Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty} | Ø§Ù„Ø³Ø¹Ø±: ${priceString}\n   Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${lineTotal.toFixed(2)}$\n\n`;
            });
            msg += `--------------------------------\n`;
            if(savedAmount > 0) { msg += `ğŸ‰ *Ù„Ù‚Ø¯ ÙˆÙØ±Øª: ${savedAmount.toFixed(2)} $* \n`; }
            msg += `ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${total.toFixed(2)} $*`;
            window.open(`https://wa.me/${PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
            localStorage.removeItem('altheeb_cart'); cart = []; updateCartCount(); closeCart();
        }
    </script>
</body>
</html>
