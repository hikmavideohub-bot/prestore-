<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ØªÙƒØ§Ù…Ù„">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --primary:#1f3a5f;
      --primary-dark:#132a46;
      --primary-light:#2f568b;

      --secondary:#ff8a1f;
      --secondary-dark:#e56f00;
      --secondary-light:#ffb15c;

      --accent:#21c28a;
      --accent-dark:#159c6d;
      --accent-light:#37d9a3;

      --danger:#ff4d6d;
      --danger-dark:#d93752;

      --bg:#f4f7fb;
      --card:#ffffff;
      --muted:#7a8797;
      --text:#1f2937;

      --shadow: 0 10px 30px rgba(16,24,40,.08);
      --shadow-lg: 0 16px 50px rgba(16,24,40,.14);

      --radius:14px;
      --radius-lg:22px;

      --transition: all .25s ease;
    }

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Tajawal', sans-serif;
      background:
        radial-gradient(800px 400px at 20% 0%, rgba(255,138,31,.18), transparent 60%),
        radial-gradient(900px 450px at 90% 10%, rgba(33,194,138,.14), transparent 55%),
        var(--bg);
      color: var(--text);
      line-height: 1.65;
      padding-top: 108px;
    }

    /* Header */
    header{
      position:fixed; top:0; width:100%; z-index:1000;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color:#fff;
      box-shadow: var(--shadow-lg);
    }
    .header-container{
      max-width:1300px; margin:0 auto; padding: 0.9rem 1.25rem;
      display:flex; align-items:center; justify-content:space-between; gap:1rem;
    }
    .logo{
      display:flex; align-items:center; gap:.75rem; cursor:pointer;
      min-width: 0;
    }
    .logo i{
      font-size: 2rem; color: var(--secondary);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.15));
    }
    .logo h1{
      font-size:1.55rem; font-weight:800;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* Nav */
    .nav-menu{
      display:flex; align-items:center; gap:1.6rem;
    }
    .nav-item{position:relative}
    .nav-link{
      color: rgba(255,255,255,.92);
      font-weight:600;
      padding: .5rem 0;
      display:flex; align-items:center; gap:.5rem;
      cursor:pointer;
      transition: var(--transition);
    }
    .nav-link:hover{color:#fff; transform: translateY(-1px);}
    .nav-link.active{color:#fff;}
    .nav-link.active::after{
      content:'';
      position:absolute; bottom:0; right:0;
      width:100%; height:3px;
      background: linear-gradient(90deg, var(--secondary), var(--accent));
      border-radius: 3px 3px 0 0;
    }

    /* Header right */
    .store-info-header{
      display:flex; align-items:center; gap:1rem;
    }
    .contact-pill{
      display:flex; align-items:center; gap:.5rem;
      padding: .45rem .75rem;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.16);
      font-size:.92rem;
      backdrop-filter: blur(10px);
      white-space: nowrap;
      max-width: 240px;
    }
    .contact-pill span{
      overflow:hidden; text-overflow:ellipsis;
    }
    .contact-pill i{color: var(--secondary)}
    .cart-icon{
      position:relative;
      cursor:pointer;
      font-size:1.4rem;
      padding:.6rem .7rem;
      border-radius: 999px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.16);
      transition: var(--transition);
      backdrop-filter: blur(10px);
    }
    .cart-icon:hover{transform: translateY(-2px); background: rgba(255,255,255,.18);}
    .cart-badge{
      position:absolute; top:-7px; left:-7px;
      width:22px; height:22px;
      border-radius:999px;
      background: var(--danger);
      border: 2px solid rgba(255,255,255,.9);
      display:flex; align-items:center; justify-content:center;
      font-size:.75rem; font-weight:800;
    }

    .mobile-toggle{
      display:none;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.16);
      color:#fff;
      font-size:1.4rem;
      padding:.55rem .8rem;
      border-radius: 14px;
      cursor:pointer;
    }

    /* Announcement bar */
    #announcement-bar{
      background: linear-gradient(90deg, var(--secondary), var(--secondary-light));
      color:#fff;
      padding:.7rem 0;
      position:fixed; top:78px; width:100%;
      z-index:999;
      overflow:hidden;
      text-align:center;
      box-shadow: 0 10px 18px rgba(255,138,31,.22);
    }
    .announcement-content{
      max-width:1300px;
      margin:0 auto;
      padding: 0 1.25rem;
      display:flex; align-items:center; justify-content:center;
      gap:.8rem;
      white-space: nowrap;
      animation: slideRight 18s linear infinite;
    }
    .announcement-content i{font-size:1.15rem; animation: bounce 2s infinite;}
    @keyframes slideRight{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}

    /* Main */
    .main-content{min-height: calc(100vh - 420px); padding: 2.2rem 0;}
    .container{max-width:1300px; margin:0 auto; padding: 0 1.25rem;}
    .page{display:none; animation: fadeIn .45s ease;}
    .page.active{display:block;}
    @keyframes fadeIn{from{opacity:0; transform: translateY(10px)}to{opacity:1; transform: translateY(0)}}

    /* Category nav */
    .category-nav{
      background: rgba(255,255,255,.7);
      border: 1px solid rgba(16,24,40,.06);
      backdrop-filter: blur(10px);
      border-radius: var(--radius-lg);
      padding: .9rem;
      margin-bottom: 1.6rem;
      box-shadow: var(--shadow);
      display:flex; flex-wrap:wrap; gap:.7rem; justify-content:center;
      position: sticky; top: 132px; z-index: 99;
    }
    .cat-btn{
      background: rgba(31,58,95,.06);
      color: var(--text);
      padding: .55rem 1.25rem;
      border-radius: 999px;
      font-weight:700;
      border: 1px solid rgba(16,24,40,.08);
      cursor:pointer;
      display:flex; align-items:center; gap:.5rem;
      transition: var(--transition);
    }
    .cat-btn:hover{transform: translateY(-2px); background: rgba(31,58,95,.10);}
    .cat-btn.active{
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color:#fff;
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 10px 22px rgba(19,42,70,.22);
    }

    /* Products grid */
    .products-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2.8rem;
    }

    .section-header{
      text-align:center;
      margin-bottom: 1.8rem;
      position:relative;
    }
    .section-header h2{
      font-size: 2rem;
      color: var(--primary);
      margin-bottom:.5rem;
      font-weight:800;
      letter-spacing: .2px;
    }
    .section-header p{
      color: var(--muted);
      font-size: 1.07rem;
      max-width: 720px;
      margin: 0 auto;
    }
    .section-header::after{
      content:'';
      position:absolute;
      bottom:-12px;
      right:50%;
      transform: translateX(50%);
      width: 96px; height: 4px;
      background: linear-gradient(90deg, var(--secondary), var(--accent));
      border-radius: 999px;
    }

    /* Product card */
    .product-card{
      background: var(--card);
      border-radius: var(--radius-lg);
      overflow:hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
      display:flex; flex-direction:column;
      position:relative;
      border: 1px solid rgba(16,24,40,.06);
    }
    .product-card:hover{
      transform: translateY(-8px);
      box-shadow: var(--shadow-lg);
    }
    .product-card.inactive{
      opacity:.72;
      filter: grayscale(.55);
    }
    .product-card.inactive:hover{transform:none; box-shadow: var(--shadow);}

    .product-image-container{
      position:relative;
      height: 220px;
      overflow:hidden;
      background: linear-gradient(135deg, rgba(31,58,95,.10), rgba(33,194,138,.08));
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .product-image{
      width:100%; height:100%;
      object-fit: cover;
      transition: var(--transition);
      display:block;
    }
    .product-card:hover .product-image{transform: scale(1.05);}

    .placeholder-image{
      width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      text-align:center;
      color: rgba(31,41,55,.65);
      font-weight:800;
      padding: 12px;
    }
    .placeholder-image .ph{
      background: rgba(255,255,255,.75);
      border: 1px dashed rgba(16,24,40,.18);
      border-radius: 14px;
      padding: 10px 12px;
      box-shadow: 0 10px 20px rgba(16,24,40,.06);
      line-height: 1.2;
    }
    .placeholder-image .ph small{
      display:block;
      margin-top:6px;
      font-weight:700;
      color: rgba(31,41,55,.72);
    }

    /* Badges */
    .product-badges{
      position:absolute;
      top:.75rem;
      right:.75rem;
      display:flex;
      flex-direction: column;
      gap:.45rem;
      z-index:2;
    }
    .discount-badge{
      background: linear-gradient(135deg, var(--danger), var(--danger-dark));
      color:#fff;
      padding:.35rem .75rem;
      border-radius: 10px;
      font-size:.85rem;
      font-weight:900;
      box-shadow: 0 10px 18px rgba(255,77,109,.25);
    }
    .bundle-badge{
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color:#fff;
      padding:.35rem .75rem;
      border-radius: 10px;
      font-size:.85rem;
      font-weight:900;
      white-space:nowrap;
      box-shadow: 0 10px 18px rgba(33,194,138,.18);
    }
    .inactive-badge{
      background: rgba(31,41,55,.88);
      color:#fff;
      padding:.35rem .75rem;
      border-radius: 10px;
      font-size:.85rem;
      font-weight:900;
    }

    .product-info{
      padding: 1.25rem 1.25rem 1.15rem;
      flex:1;
      display:flex; flex-direction:column;
      gap:.7rem;
    }
    .product-title{
      font-size: 1.18rem;
      font-weight:900;
      color: var(--text);
      line-height: 1.35;
      letter-spacing: .2px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .product-title .desc-toggle {
      color: var(--secondary);
      font-size: 0.9rem;
      transition: var(--transition);
    }
    .product-title:hover .desc-toggle {
      color: var(--secondary-dark);
    }
    .product-desc{
      color: var(--muted);
      font-size: .92rem;
      line-height: 1.7;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .product-desc.expanded {
      max-height: 500px;
      margin-top: 0.5rem;
    }
    .product-size{
      font-size:.9rem;
      color: rgba(31,41,55,.86);
      display:flex; align-items:center; gap:.5rem;
    }
    .product-size i{color: var(--secondary);}

    .bundle-info{
      background: rgba(33,194,138,.10);
      border: 1px solid rgba(33,194,138,.18);
      padding:.75rem;
      border-radius: 12px;
      border-right: 4px solid var(--accent);
      text-align:center;
      color: var(--accent-dark);
      font-weight:800;
      font-size:.88rem;
    }

    .price-container{margin-top:auto; display:flex; flex-direction:column; gap:.75rem;}
    .price-wrapper{
      display:flex; align-items:baseline; gap:.8rem; flex-wrap:wrap;
      justify-content:flex-start;
    }
    .price-old{text-decoration: line-through; color: rgba(122,135,151,.9); font-size:.95rem;}
    .price-new{font-size: 1.55rem; font-weight:900; color: var(--text);}
    .price-new.discount{color: var(--danger-dark);}
    .price-new.bundle{color: var(--accent-dark);}

    .add-btn{
      width:100%;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color:#fff;
      border:none;
      padding: .95rem 1rem;
      border-radius: 14px;
      font-size: 1rem;
      font-weight:900;
      cursor:pointer;
      transition: var(--transition);
      display:flex; align-items:center; justify-content:center; gap:.6rem;
      box-shadow: 0 14px 28px rgba(19,42,70,.18);
    }
    .add-btn:hover{transform: translateY(-2px); background: linear-gradient(135deg, var(--primary-light), var(--primary));}
    .add-btn:disabled{background: #a0a9b4; cursor:not-allowed; transform:none !important; box-shadow:none;}

    /* Inactive section */
    .inactive-section{
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(16,24,40,.06);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-top: 2.5rem;
      box-shadow: var(--shadow);
    }
    .toggle-inactive-btn{
      background: rgba(31,58,95,.06);
      border: 1px solid rgba(16,24,40,.08);
      padding: .85rem 1.4rem;
      border-radius: 16px;
      font-weight:900;
      display:flex; align-items:center; gap:.6rem; justify-content:center;
      margin: 0 auto 1.4rem;
      cursor:pointer;
      transition: var(--transition);
    }
    .toggle-inactive-btn:hover{background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color:#fff; transform: translateY(-2px);}

    /* Offers */
    .offers-banner{
      background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
      color:#fff;
      border-radius: var(--radius-lg);
      padding: 1.8rem;
      margin-bottom: 2rem;
      display:flex; align-items:center; justify-content:space-between;
      flex-wrap:wrap;
      gap: 1.2rem;
      box-shadow: 0 18px 34px rgba(255,138,31,.22);
    }
    .offers-banner h1{font-size: 1.85rem; font-weight:900;}
    .offers-banner p{font-size: 1.1rem; opacity:.95;}
    .timer{
      display:flex; gap:.75rem;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.22);
      padding: .95rem;
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }
    .timer-item{display:flex; flex-direction:column; align-items:center; min-width:70px;}
    .timer-value{font-size: 2rem; font-weight:900; line-height:1;}
    .timer-label{font-size:.85rem; opacity:.92;}

    /* Contact */
    .contact-container{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.6rem;
      margin-bottom: 3rem;
    }
    .contact-info{
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(16,24,40,.06);
      border-radius: var(--radius-lg);
      padding: 1.8rem;
      box-shadow: var(--shadow);
    }
    .contact-info h3{
      font-size: 1.5rem;
      margin-bottom: 1.2rem;
      color: var(--primary);
      font-weight: 900;
      position:relative;
      padding-bottom:.7rem;
    }
    .contact-info h3::after{
      content:'';
      position:absolute;
      bottom:0; right:0;
      width:70px; height:4px;
      background: linear-gradient(90deg, var(--secondary), var(--accent));
      border-radius: 999px;
    }
    .contact-details{display:flex; flex-direction:column; gap:1.2rem;}
    .contact-item{display:flex; align-items:flex-start; gap: 1rem;}
    .contact-icon{
      width:52px; height:52px;
      background: rgba(255,138,31,.12);
      border: 1px solid rgba(255,138,31,.18);
      border-radius: 999px;
      display:flex; align-items:center; justify-content:center;
      font-size: 1.2rem;
      color: var(--secondary-dark);
      flex:0 0 auto;
      box-shadow: 0 12px 20px rgba(255,138,31,.10);
    }
    .contact-text h4{font-size: 1.06rem; margin-bottom:.2rem; font-weight:900;}
    .contact-text p{color: var(--muted); line-height: 1.7;}

    .map-wrap{
      margin-top: 1.1rem;
      border-radius: var(--radius-lg);
      overflow:hidden;
      border: 1px solid rgba(16,24,40,.08);
      box-shadow: var(--shadow);
      background: #fff;
    }
    .map-wrap iframe{
      width:100%;
      height: 320px;
      border:0;
      display:block;
    }

    /* Social links */
    .social-links{display:flex; gap:.9rem; margin-top: 1.2rem;}
    .social-links a{
      width:46px; height:46px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: 1px solid rgba(255,255,255,.10);
      color:#fff;
      display:flex; align-items:center; justify-content:center;
      font-size: 1.2rem;
      transition: var(--transition);
      box-shadow: 0 14px 24px rgba(19,42,70,.16);
    }
    .social-links a:hover{transform: translateY(-4px);}
    .social-links a.facebook:hover{background:#1877F2}
    .social-links a.instagram:hover{background:#E4405F}
    .social-links a.tiktok:hover{background:#000}

    /* Loading */
    .loading{text-align:center; padding: 4rem 0; color: var(--muted);}
    .loading-spinner{
      display:inline-block;
      width: 62px; height: 62px;
      border: 5px solid rgba(122,135,151,.25);
      border-top-color: var(--secondary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Modal cart - COMPLETELY REVISED */
    .modal{
      display:none;
      position:fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,.55);
      z-index: 2000;
      overflow-y: auto; /* Allows scrolling the whole modal */
    }
    .modal.active{
      display:block;
    }
    .modal-content{
      background:#fff;
      width: 100%;
      max-width: 650px;
      min-height: 100vh; /* Full height on mobile */
      margin: 0 auto;
      position: relative;
      display:flex;
      flex-direction:column;
      box-shadow: 0 24px 60px rgba(0,0,0,.25);
    }
    @media (min-width: 768px) {
      .modal-content{
        min-height: auto;
        max-height: 90vh;
        margin: 2rem auto;
        border-radius: var(--radius-lg);
        overflow: hidden;
      }
    }

    .modal-header{
      padding: 1.2rem 1.3rem;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color:#fff;
      display:flex; align-items:center; justify-content:space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .modal-header h3{font-size: 1.35rem; font-weight:900; display:flex; gap:.6rem; align-items:center}
    .close-modal{
      background:none;
      border:none;
      font-size: 2rem;
      color:#fff;
      cursor:pointer;
      line-height:1;
      transition: var(--transition);
    }
    .close-modal:hover{color: var(--secondary); transform: rotate(6deg);}

    .cart-items-container{
      flex: 1;
      overflow-y: auto;
      padding: 1.2rem 1.3rem;
      min-height: 200px;
    }
    .cart-empty{
      text-align:center; 
      padding: 2rem; 
      color: var(--muted);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 200px;
    }
    .cart-empty i{font-size: 3rem; margin-bottom: .8rem; color: rgba(122,135,151,.25);}

    .cart-item{
      display:flex; 
      justify-content:space-between; 
      align-items:flex-start;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(16,24,40,.08);
      gap: 1rem;
    }
    .cart-item:last-child{border-bottom:none}
    .item-info{flex:1; min-width: 0;}
    .item-name{font-weight:900; margin-bottom:.2rem; color: var(--primary);}
    .item-size{font-size:.86rem; color: var(--muted); margin-bottom:.35rem;}
    .item-price{color: var(--secondary-dark); font-weight:900; display:flex; align-items:center; gap:.5rem; flex-wrap:wrap}
    .item-price .old-price{color: var(--muted); text-decoration: line-through; font-weight:800}
    .bundle-note{font-size:.82rem; color: var(--accent-dark); font-weight:900}
    .item-controls{
      display:flex; align-items:center; gap:.6rem;
      flex: 0 0 auto;
    }
    .item-controls button{
      width:34px; height:34px;
      border:none;
      background: rgba(31,58,95,.08);
      border: 1px solid rgba(16,24,40,.10);
      color: var(--text);
      border-radius: 999px;
      cursor:pointer;
      font-weight:900;
      display:flex; align-items:center; justify-content:center;
      transition: var(--transition);
    }
    .item-controls button:hover{background: var(--secondary); color:#fff; border-color: rgba(255,255,255,.18);}
    .remove-item-btn{background: rgba(255,77,109,.08) !important; color: var(--danger-dark) !important;}
    .remove-item-btn:hover{background: var(--danger) !important; color:#fff !important;}
    .item-qty{min-width: 24px; text-align:center; font-weight:900;}

    .cart-summary{
      padding: 1.2rem 1.3rem;
      background: rgba(244,247,251,.65);
      border-top: 1px solid rgba(16,24,40,.10);
    }
    .summary-row{display:flex; justify-content:space-between; margin-bottom:.7rem; font-size: 1rem;}
    .summary-row.total{
      font-size: 1.35rem;
      font-weight: 900;
      color: var(--primary);
      border-top: 1px solid rgba(16,24,40,.10);
      padding-top: .8rem;
      margin-top: .6rem;
    }

    .customer-details{
      margin-top: .85rem;
    }
    .customer-details summary{
      cursor:pointer;
      font-weight:900;
      padding: .85rem 1rem;
      border-radius: 14px;
      background: rgba(31,58,95,.08);
      border: 1px solid rgba(16,24,40,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    
    .checkout-form{
      padding: 1rem;
      background: rgba(255,255,255,.9);
      border: 1px solid rgba(16,24,40,.10);
      border-top: none;
      border-bottom-left-radius: 14px;
      border-bottom-right-radius: 14px;
    }

    .form-group{margin-bottom: 1rem;}
    .form-group label{display:block; margin-bottom:.5rem; font-weight:900;}
    .form-control{
      width:100%;
      padding: .95rem;
      border: 1px solid rgba(16,24,40,.14);
      border-radius: 14px;
      font-family:'Tajawal', sans-serif;
      font-size: 1rem;
      transition: var(--transition);
      background: rgba(255,255,255,.9);
    }
    .form-control:focus{
      outline:none;
      border-color: rgba(255,138,31,.65);
      box-shadow: 0 0 0 4px rgba(255,138,31,.18);
    }

    .checkout-btn{
      width:100%;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color:#fff;
      border:none;
      padding: 1rem;
      border-radius: 14px;
      font-size: 1.12rem;
      font-weight: 900;
      cursor:pointer;
      display:flex; align-items:center; justify-content:center; gap:.6rem;
      transition: var(--transition);
      box-shadow: 0 16px 30px rgba(33,194,138,.18);
      margin-top: .9rem;
    }
    .checkout-btn:hover{transform: translateY(-2px); background: linear-gradient(135deg, var(--accent-dark), var(--accent));}

    /* FAB */
    .fab{
      position:fixed;
      bottom: 1.5rem;
      left: 1.5rem;
      width: 58px; height: 58px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
      color:#fff;
      display:flex; align-items:center; justify-content:center;
      font-size: 1.45rem;
      box-shadow: 0 22px 40px rgba(255,138,31,.28);
      cursor:pointer;
      z-index: 999;
      transition: var(--transition);
    }
    .fab:hover{transform: translateY(-5px) scale(1.04);}

    /* Footer */
    footer{
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color:#fff;
      padding: 3rem 0 1.6rem;
      margin-top: 3.8rem;
    }
    .footer-container{
      max-width:1300px; margin:0 auto; padding: 0 1.25rem;
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
    }
    .footer-section h4{
      font-size: 1.25rem;
      margin-bottom: 1.2rem;
      color: var(--secondary-light);
      font-weight: 900;
      position:relative;
      padding-bottom: .5rem;
    }
    .footer-section h4::after{
      content:'';
      position:absolute;
      bottom:0; right:0;
      width: 55px; height: 3px;
      background: var(--secondary);
      border-radius: 999px;
    }
    .footer-section p{color: rgba(255,255,255,.86); margin-bottom: 1rem;}
    .footer-section ul{list-style:none}
    .footer-section ul li{margin-bottom:.75rem}
    .footer-section ul li a{
      color: rgba(255,255,255,.86);
      text-decoration:none;
      transition: var(--transition);
      display:flex; align-items:center; gap:.55rem;
      cursor:pointer;
    }
    .footer-section ul li a:hover{color:#fff; transform: translateX(-3px);}

    .footer-bottom{
      text-align:center;
      padding-top: 2rem;
      margin-top: 2rem;
      border-top: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.72);
      font-size: .92rem;
    }

    /* Responsive - IMPROVED MOBILE DISPLAY */
    @media (max-width: 992px){
      .nav-menu{
        position:fixed;
        top: 78px;
        right: -110%;
        width: min(360px, 86vw);
        height: calc(100vh - 78px);
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        flex-direction:column;
        align-items:flex-start;
        padding: 1.6rem;
        transition: right .28s ease;
        z-index: 999;
        box-shadow: var(--shadow-lg);
        gap: 1.15rem;
      }
      .nav-menu.active{right:0}
      .mobile-toggle{display:block}
      body{padding-top: 148px;}
      #announcement-bar{top: 96px;}
      .category-nav{top: 162px;}
      .contact-pill{display:none;} /* cleaner on mobile */
      
      /* Mobile-specific product grid - KACHELSTIL (QUADRATISCH) */
      .products-grid{
        grid-template-columns: repeat(3, 1fr); /* 3 products per row */
        gap: 0.7rem; /* Smaller gap */
      }
      
      /* SQUARE product images for mobile - KACHELSTIL */
      .product-image-container{
        height: 0;
        padding-bottom: 100%; /* Creates a square aspect ratio */
        position: relative;
      }
      
      .product-image-container img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      /* Hide product description completely on mobile */
      .product-desc {
        display: none !important;
      }
      
      /* Hide description toggle on mobile */
      .product-title .desc-toggle {
        display: none;
      }
      
      /* Adjust product info padding for smaller cards */
      .product-info{
        padding: 0.8rem;
        gap: 0.4rem;
      }
      
      /* Smaller product title on mobile */
      .product-title{
        font-size: 0.85rem;
        line-height: 1.2;
        margin-bottom: 0.2rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.2rem;
      }
      
      /* Smaller price on mobile */
      .price-new{
        font-size: 1rem;
      }
      .price-old {
        font-size: 0.8rem;
      }
      
      /* Smaller add button on mobile */
      .add-btn{
        padding: 0.6rem;
        font-size: 0.8rem;
        border-radius: 10px;
      }
      
      /* Smaller badges on mobile */
      .discount-badge,
      .bundle-badge,
      .inactive-badge{
        font-size: 0.65rem;
        padding: 0.2rem 0.4rem;
        border-radius: 6px;
      }
      
      /* Hide size on mobile to save space */
      .product-size {
        display: none;
      }
      
      /* Hide bundle info on mobile */
      .bundle-info {
        display: none;
      }
      
      /* Price wrapper adjustments */
      .price-wrapper {
        flex-direction: column;
        gap: 0.2rem;
        align-items: flex-start;
      }
      
      /* Price container adjustments */
      .price-container {
        gap: 0.5rem;
      }
    }
    
    @media (max-width: 768px){
      /* For tablets */
      .products-grid{
        grid-template-columns: repeat(3, 1fr);
        gap: 0.7rem;
      }
      
      .product-info{
        padding: 0.7rem;
      }
      
      .timer{width:100%; justify-content:center;}
      .timer-item{min-width: 60px;}
      .timer-value{font-size: 1.8rem;}
    }
    
    @media (max-width: 480px){
      /* For small phones - keep 3 products if screen is wide enough */
      .products-grid{
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
      }
      
      /* Even more compact on very small screens */
      .product-info{
        padding: 0.5rem;
      }
      
      .product-title{
        font-size: 0.75rem;
      }
      
      .add-btn{
        padding: 0.4rem;
        font-size: 0.7rem;
      }
      
      .price-new{
        font-size: 0.9rem;
      }
      
      .logo h1{font-size: 1.35rem;}
      .section-header h2{font-size: 1.55rem;}
      .fab{width:52px; height:52px; font-size:1.3rem; bottom: 1rem; left: 1rem;}
    }
    
    @media (max-width: 360px){
      /* For very small phones */
      .products-grid{
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }
    }
    
    /* Desktop specific - show description toggle only on desktop */
    @media (min-width: 993px){
      .product-desc {
        max-height: 3.2em;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      .product-desc.expanded {
        display: block;
        -webkit-line-clamp: unset;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <div class="header-container">
      <div class="logo" onclick="navigateToPage('home')">
        <i class="fas fa-store"></i>
        <h1 id="store-name">Ù…ØªØ¬Ø±</h1>
      </div>

      <!-- Navigation Menu -->
      <nav class="nav-menu" id="navMenu">
        <div class="nav-item"><a class="nav-link active" data-page="home"><i class="fas fa-home"></i><span>Home</span></a></div>
        <div class="nav-item"><a class="nav-link" data-page="offers"><i class="fas fa-percentage"></i><span>Angebote</span></a></div>
        <div class="nav-item"><a class="nav-link" data-page="about"><i class="fas fa-info-circle"></i><span>About</span></a></div>
        <div class="nav-item"><a class="nav-link" data-page="contact"><i class="fas fa-address-book"></i><span>Kontakt</span></a></div>
      </nav>

      <!-- Store Info & Cart -->
      <div class="store-info-header">
        <div class="contact-pill" title="Ø§Ù„Ù‡Ø§ØªÙ">
          <i class="fas fa-phone"></i>
          <span id="store-phone">...</span>
        </div>

        <div class="cart-icon" onclick="openCart()">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-badge" id="cart-badge">0</span>
        </div>

        <button class="mobile-toggle" id="mobileToggle" aria-label="menu">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Announcement Bar -->
  <div id="announcement-bar" style="display:none;">
    <div class="announcement-content">
      <i class="fas fa-bullhorn"></i>
      <span id="announcement-text"></span>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Home Page -->
    <section id="home-page" class="page active">
      <div class="container">
        <div id="category-nav" class="category-nav" style="display:none;"></div>

        <div id="loading" class="loading">
          <div class="loading-spinner"></div>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
        </div>

        <div id="products-grid" class="products-grid"></div>

        <div class="admin-toggle" id="inactive-toggle" style="display:none;">
          <button class="toggle-inactive-btn" onclick="toggleInactive()">
            <i class="fas fa-eye-slash"></i> <span id="toggle-inactive-text">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø©</span>
          </button>
        </div>

        <div id="inactive-section" class="inactive-section" style="display:none;">
          <div class="section-header">
            <h2>â›” Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø© / Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©</h2>
            <p>Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù„Ù„Ø·Ù„Ø¨</p>
          </div>
          <div id="inactive-grid" class="products-grid"></div>
        </div>
      </div>
    </section>

    <!-- About Page -->
    <section id="about-page" class="page">
      <div class="container">
        <div class="section-header">
          <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h2>
          <p>Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØªÙ… Ø¬Ù„Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Google Sheets</p>
        </div>

        <div class="contact-container">
          <div class="contact-info">
            <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>
            <div class="contact-details">
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-phone"></i></div>
                <div class="contact-text"><h4>Ø§Ù„Ù‡Ø§ØªÙ</h4><p id="about-phone">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fab fa-whatsapp"></i></div>
                <div class="contact-text"><h4>ÙˆØ§ØªØ³Ø§Ø¨</h4><p id="about-whatsapp">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-envelope"></i></div>
                <div class="contact-text"><h4>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h4><p id="about-email">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-clock"></i></div>
                <div class="contact-text"><h4>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</h4><p id="about-hours">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-shipping-fast"></i></div>
                <div class="contact-text"><h4>Ø§Ù„Ø´Ø­Ù†</h4><p id="about-shipping">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-tag"></i></div>
                <div class="contact-text"><h4>Ø§Ù„Ø¹Ù…Ù„Ø©</h4><p><span id="about-currency">...</span></p></div>
              </div>
            </div>
          </div>

          <div class="contact-info">
            <h3>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</h3>
            <div class="contact-details">
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-map-marker-alt"></i></div>
                <div class="contact-text"><h4>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h4><p id="about-address">...</p></div>
              </div>
              <div class="map-wrap" id="about-map-wrap" style="display:none;">
                <iframe id="about-map" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
              </div>
              <div style="color:var(--muted); font-weight:800; margin-top:.75rem" id="about-map-hint"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Offers Page -->
    <section id="offers-page" class="page">
      <div class="container">
        <div class="offers-banner">
          <div>
            <h1>ğŸ‰ Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ© Ù„Ø§ ØªÙØ¹ÙˆØ¶!</h1>
            <p>Ø§Ø³ØªÙØ¯ Ù…Ù† Ø¹Ø±ÙˆØ¶Ù†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</p>
          </div>
          <div class="timer">
            <div class="timer-item"><span class="timer-value" id="days">00</span><span class="timer-label">Ø£ÙŠØ§Ù…</span></div>
            <div class="timer-item"><span class="timer-value" id="hours">00</span><span class="timer-label">Ø³Ø§Ø¹Ø§Øª</span></div>
            <div class="timer-item"><span class="timer-value" id="minutes">00</span><span class="timer-label">Ø¯Ù‚Ø§Ø¦Ù‚</span></div>
            <div class="timer-item"><span class="timer-value" id="seconds">00</span><span class="timer-label">Ø«ÙˆØ§Ù†ÙŠ</span></div>
          </div>
        </div>

        <div class="section-header">
          <h2>Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©</h2>
          <p>ØªØµÙØ­ Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ø¨Ø®ØµÙˆÙ…Ø§Øª ÙˆØ¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©</p>
        </div>

        <div id="offers-grid" class="products-grid"></div>

        <div id="no-offers" class="empty-state" style="display:none; text-align:center; padding:3rem; color:var(--muted);">
          <i class="fas fa-percentage" style="font-size:3rem; color: rgba(122,135,151,.25);"></i>
          <h3 style="margin-top:1rem; font-weight:900;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
          <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù†Ø´Ø·Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</p>
        </div>
      </div>
    </section>

    <!-- Contact Page -->
    <section id="contact-page" class="page">
      <div class="container">
        <div class="section-header">
          <h2>Ø§ØªØµÙ„ Ø¨Ù†Ø§</h2>
          <p>Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ø®Ø¯Ù…ØªÙƒÙ…</p>
        </div>

        <div class="contact-container">
          <div class="contact-info">
            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
            <div class="contact-details">
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-phone"></i></div>
                <div class="contact-text"><h4 id="contact-phone-title">Ø§Ù„Ù‡Ø§ØªÙ</h4><p id="contact-phone-text">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fab fa-whatsapp"></i></div>
                <div class="contact-text"><h4 id="contact-whatsapp-title">ÙˆØ§ØªØ³Ø§Ø¨</h4><p id="contact-whatsapp-text">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-envelope"></i></div>
                <div class="contact-text"><h4 id="contact-email-title">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h4><p id="contact-email-text">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-map-marker-alt"></i></div>
                <div class="contact-text"><h4 id="contact-address-title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</h4><p id="contact-address-text">...</p></div>
              </div>

              <div class="social-links" id="social-links"></div>

              <div class="map-wrap" id="contact-map-wrap" style="display:none;">
                <iframe id="contact-map" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
              </div>
              <div style="color:var(--muted); font-weight:800; margin-top:.75rem" id="contact-map-hint"></div>
            </div>
          </div>

          <div class="contact-info">
            <h3>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</h3>
            <div class="contact-details">
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-clock"></i></div>
                <div class="contact-text"><h4>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</h4><p id="working-hours-weekdays">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-shipping-fast"></i></div>
                <div class="contact-text"><h4>Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</h4><p id="working-hours-delivery">...</p></div>
              </div>
              <div class="contact-item">
                <div class="contact-icon"><i class="fas fa-tag"></i></div>
                <div class="contact-text"><h4>Ø§Ù„Ø¹Ù…Ù„Ø©</h4><p><span id="contact-currency">...</span></p></div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <!-- Cart Modal - COMPLETELY REVISED -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-shopping-cart"></i> Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
        <button class="close-modal" onclick="closeCart()">&times;</button>
      </div>

      <div id="cart-items" class="cart-items-container">
        <!-- Cart items will be loaded here -->
        <div class="cart-empty">
          <i class="fas fa-shopping-basket"></i>
          <p>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙØ§Ø±ØºØ©</p>
        </div>
      </div>

      <div class="cart-summary" id="cart-summary" style="display:none;">
        <div class="summary-row"><span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span><span id="cart-subtotal">0</span></div>
        <div class="summary-row"><span>Ø§Ù„Ø´Ø­Ù†:</span><span id="cart-shipping">0</span></div>
        <div class="summary-row total"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span><span id="cart-total">0</span></div>

        <details class="customer-details">
          <summary>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø¶ØºØ· Ù„Ù„ÙØªØ­)</summary>
          <div class="checkout-form">
            <div class="form-group">
              <label for="cust-name"><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
              <input type="text" id="cust-name" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>
            </div>
            <div class="form-group">
              <label for="cust-phone"><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
              <input type="tel" id="cust-phone" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ" required>
            </div>
            <div class="form-group">
              <label for="cust-address"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>
              <textarea id="cust-address" class="form-control" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù†Ùƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„" required></textarea>
            </div>

            <button class="checkout-btn" onclick="checkout()">
              <i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
            </button>
          </div>
        </details>
      </div>
    </div>
  </div>

  <!-- Floating Cart Button -->
  <div class="fab" onclick="openCart()"><i class="fas fa-shopping-basket"></i></div>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h4 id="footer-store-name">Ù…ØªØ¬Ø±</h4>
        <p id="footer-store-description">...</p>
        <div class="social-links" id="footer-social-links"></div>
      </div>

      <div class="footer-section">
        <h4>Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h4>
        <ul>
          <li><a data-page="home"><i class="fas fa-chevron-left"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li><a data-page="about"><i class="fas fa-chevron-left"></i> Ø­ÙˆÙ„Ù†Ø§</a></li>
          <li><a data-page="offers"><i class="fas fa-chevron-left"></i> Ø§Ù„Ø¹Ø±ÙˆØ¶</a></li>
          <li><a data-page="contact"><i class="fas fa-chevron-left"></i> Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h4>
        <ul>
          <li><a><i class="fas fa-phone"></i> <span id="footer-phone">...</span></a></li>
          <li><a><i class="fab fa-whatsapp"></i> <span id="footer-whatsapp">...</span></a></li>
          <li><a><i class="fas fa-envelope"></i> <span id="footer-email">...</span></a></li>
          <li><a><i class="fas fa-map-marker-alt"></i> <span id="footer-address">...</span></a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h4>
        <ul>
          <li><a><i class="fas fa-clock"></i> <span id="footer-hours">...</span></a></li>
          <li><a><i class="fas fa-shipping-fast"></i> <span id="footer-shipping">...</span></a></li>
          <li><a><i class="fas fa-tag"></i> Ø§Ù„Ø¹Ù…Ù„Ø©: <span id="footer-currency">...</span></a></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>Â© <span id="current-year"></span> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - <span id="footer-store-name-bottom">Ù…ØªØ¬Ø±</span></p>
      <p>ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ø¯Ù‚Ø© Ù…Ù† Ø£Ø¬Ù„ÙƒÙ…</p>
    </div>
  </footer>

<script>
/* ========================================
   âš™ï¸ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…
   ======================================== */
const API_URL = 'https://script.google.com/macros/s/AKfycbxmTLI6-1V7tELp7uvkDnCAMDCp6M5ZPsl4lZFL6KmaBRH9Hc9dqQdsgRDs0deca4RV6w/exec';
const STORE_ID = 'a083e1e2'; // ØºÙŠÙ‘Ø± Ù‡Ø°Ø§ ÙÙ‚Ø· Ù„Ø±Ø¨Ø· Ù…ØªØ¬Ø± Ø¢Ø®Ø±

/* ========================================
   ğŸ§  Cache (LocalStorage) - TTL
   ======================================== */
// âœ… Admin-Bypass: ?nocache=1
const NO_CACHE = new URLSearchParams(location.search).get('nocache') === '1';

// âœ… Default TTL (wenn du nichts angibst)
const DEFAULT_CACHE_TTL_MS = 5 * 60 * 1000; // 5 Minuten

// âœ… Pro-Key TTLs (hier kannst du fein steuern)
const CACHE_TTLS = {
  websiteStatus: 30 * 1000,   // 30 Sekunden (damit Updates schnell sichtbar sind)
  products:      60 * 1000,   // 1 Minute
  categories:    5 * 60 * 1000,
  bundles:       5 * 60 * 1000,
  offers:        60 * 1000
};

function cacheKey(k){ return `cache_${STORE_ID}_${k}`; }

function cacheGet(k, ttlMs){
  if (NO_CACHE) return null;

  const ttl = typeof ttlMs === 'number'
    ? ttlMs
    : (CACHE_TTLS[k] ?? DEFAULT_CACHE_TTL_MS);

  try{
    const raw = localStorage.getItem(cacheKey(k));
    if(!raw) return null;

    const obj = JSON.parse(raw);
    if(!obj || typeof obj.ts !== 'number') return null;

    if(Date.now() - obj.ts > ttl) return null;
    return obj.data;
  }catch(e){
    return null;
  }
}

function cacheSet(k, data){
  if (NO_CACHE) return;
  try{
    localStorage.setItem(cacheKey(k), JSON.stringify({ ts: Date.now(), data }));
  }catch(e){}
}

function cacheBust(){
  try{
    Object.keys(localStorage)
      .filter(k => k.startsWith(`cache_${STORE_ID}_`))
      .forEach(k => localStorage.removeItem(k));
  }catch(e){}
}

// âœ… LÃ¶sung 1: Stale-While-Revalidate helper
// verhindert doppelte Fetches fÃ¼r denselben Key
const __fetchLocks = new Map();

function stableStringify(x){
  try { return JSON.stringify(x); } catch { return ''; }
}

async function fetchWithCache(key, fetcher, onFresh, ttlMs){
  const cached = cacheGet(key, ttlMs);

  const runFetchLocked = async () => {
    if (__fetchLocks.has(key)) return __fetchLocks.get(key);

    const p = Promise.resolve()
      .then(fetcher)
      .finally(() => __fetchLocks.delete(key));

    __fetchLocks.set(key, p);
    return p;
  };

  if (cached != null) {
    runFetchLocked()
      .then(fresh => {
        if (fresh == null) return;

        if (stableStringify(fresh) !== stableStringify(cached)) {
          cacheSet(key, fresh);
          if (typeof onFresh === 'function') onFresh(fresh, cached);
        } else {
          cacheSet(key, cached);
        }
      })
      .catch(()=>{});

    return cached;
  }

  const fresh = await runFetchLocked();
  if (fresh != null) cacheSet(key, fresh);
  if (typeof onFresh === 'function') onFresh(fresh, null);
  return fresh;
}



/* ========================================
   Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
   ======================================== */
let STORE_DATA = {};
let CURRENCY = ''; // Ø³ÙŠØªÙ… Ø¬Ù„Ø¨Ù‡Ø§ Ù…Ù† Sheets stores.currency
let cart = [];
let productsData = [];
let categoriesData = [];
let activeCategory = 'Ø§Ù„ÙƒÙ„';
let currentPage = 'home';

function cartStorageKey(){ return 'cart_' + STORE_ID; }
function loadCart(){
  try{ cart = JSON.parse(localStorage.getItem(cartStorageKey())) || []; }
  catch(e){ cart = []; }
}

/* ========================================
   ğŸš€ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
   ======================================== */
window.addEventListener('DOMContentLoaded', async () => {
  document.getElementById('current-year').textContent = new Date().getFullYear();

  if (!STORE_ID){
    const loadingEl = document.getElementById("loading");
    if (loadingEl) {
      loadingEl.innerHTML = `
        <div style="max-width:720px;margin:0 auto;background:#fff;border-radius:16px;padding:16px;border:1px solid rgba(16,24,40,.08);box-shadow:var(--shadow)">
          âš ï¸ Ø¶Ø¹ STORE_ID Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø«Ù… Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        </div>`;
    } else alert("âš ï¸ Ø¶Ø¹ STORE_ID Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø«Ù… Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©");
    return;
  }

  loadCart();
  updateCartCount();
  initNavigation();

  // âœ… website_active (cache)
  const active = await loadWebsiteStatus();
  if (!active) return;

  // âœ… store config (cache)
  await loadStoreConfig();

  // âœ… Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ A3 (cache)
  await loadCustomerMessage();

  // âœ… Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª (cache)
  await loadCategories();

  // âœ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (cache)
  await fetchProducts();

  initOfferTimer();
  showPage(currentPage);
});

/* ========================================
   âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ + Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ + Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
   ======================================== */
async function loadWebsiteStatus(){
  // websiteStatus soll schnell aktualisieren
  const STATUS_TTL_MS = 30 * 1000;

  const activeObj = await fetchWithCache(
    'websiteStatus',
    async () => {
      const ts = NO_CACHE ? `&_ts=${Date.now()}` : '';
      const res = await fetch(
        `${API_URL}?type=websiteStatus&storeId=${STORE_ID}${ts}`,
        { headers: { 'Accept': 'application/json' } }
      );

      const json = await res.json();

      // Wenn API "nicht success" -> Standard: aktiv (wie vorher)
      if (!json || !json.success) return { active: true };

      const data = json.data || {};
      const flag = data.website_active ?? data.websiteActive;
      const active = flag !== false;

      return { active };
    },
    (fresh, cached) => {
      // UI nur updaten wenn sich active wirklich geÃ¤ndert hat
      const freshActive = !!fresh?.active;
      const cachedActive = !!cached?.active;

      if (freshActive !== cachedActive) {
        if (!freshActive) {
          applyStoreInactiveUI();
        } else {
          restoreStoreUIIfNeeded();
        }
      }
    },
    STATUS_TTL_MS
  );

  const active = !!activeObj?.active;

  // sofort (cached oder fresh) anwenden
  if (!active) {
    applyStoreInactiveUI();
    return false;
  } else {
    restoreStoreUIIfNeeded();
    return true;
  }
}

function applyStoreInactiveUI(){
  const loadingEl = document.getElementById('loading');
  if (loadingEl){
    loadingEl.innerHTML = `
      <div style="max-width:720px;margin:0 auto;background:#fff;border-radius:16px;padding:16px;border:1px solid rgba(16,24,40,.08);box-shadow:var(--shadow)">
        â›” Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø± ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹.
      </div>`;
  }
  const main = document.querySelector('.main-content');
  if (main) main.style.display = 'none';
}

function restoreStoreUIIfNeeded(){
  const main = document.querySelector('.main-content');
  if (main) main.style.display = '';
}


async function loadCustomerMessage(){
  const MESSAGE_TTL_MS = 60 * 1000; // 1 Minute

  const data = await fetchWithCache(
    'customerMessage',
    async () => {
      const ts = NO_CACHE ? `&_ts=${Date.now()}` : '';
      const res = await fetch(
        `${API_URL}?type=customerMessage&storeId=${STORE_ID}${ts}`,
        { headers: { 'Accept': 'application/json' } }
      );

      const json = await res.json();
      if (!json || !json.success) return { msg: '' };

      const msg = (json.message || '').toString().trim();
      return { msg };
    },
    (fresh, cached) => {
      // UI nur aktualisieren wenn Nachricht sich geÃ¤ndert hat
      if ((fresh?.msg || '') !== (cached?.msg || '')) {
        applyCustomerMessage(fresh?.msg || '');
      }
    },
    MESSAGE_TTL_MS
  );

  applyCustomerMessage(data?.msg || '');
}

function applyCustomerMessage(msg){
  if (!msg) return;
  STORE_DATA.message = msg;
  const bar = document.getElementById('announcement-bar');
  const textEl = document.getElementById('announcement-text');
  if (bar && textEl){
    bar.style.display = 'block';
    textEl.textContent = msg;
  }
}

async function loadCategories(){
  const CATEGORIES_TTL_MS = 5 * 60 * 1000; // 5 Minuten

  const data = await fetchWithCache(
    'categories',
    async () => {
      const ts = NO_CACHE ? `&_ts=${Date.now()}` : '';
      const res = await fetch(
        `${API_URL}?type=categories&storeId=${STORE_ID}${ts}`,
        { headers: { 'Accept': 'application/json' } }
      );

      const json = await res.json();
      if (!json || !json.success) return { categories: [] };

      return {
        categories: Array.isArray(json.categories) ? json.categories : []
      };
    },
    (fresh, cached) => {
      // nur updaten wenn sich wirklich was geÃ¤ndert hat
      const freshArr = fresh?.categories || [];
      const cachedArr = cached?.categories || [];
      if (JSON.stringify(freshArr) !== JSON.stringify(cachedArr)) {
        categoriesData = freshArr;
      }
    },
    CATEGORIES_TTL_MS
  );

  categoriesData = data?.categories || [];
}

/* ========================================
   ğŸ“¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± (Sheets stores)
   ======================================== */
async function loadStoreConfig(){
  const cached = cacheGet('storeConfig');
  if (cached && cached.data){
    STORE_DATA = cached.data;
    applyStoreConfig();
    return;
  }

  try{
    const res = await fetch(`${API_URL}?type=storeConfig&storeId=${STORE_ID}&_ts=${Date.now()}`);
    const json = await res.json();
    if (!json.success) throw new Error(json.message || 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±');
    STORE_DATA = json.data || {};
    cacheSet('storeConfig', {data: STORE_DATA});
    applyStoreConfig();
  }catch(e){
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±:', e);
    showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.', 'error');
  }
}

function applyStoreConfig(){
  // âœ… currency Ù…Ù† Sheet stores.currency (Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØ«Ø¨ÙŠØª Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯)
  CURRENCY = (STORE_DATA.currency || '').toString().trim();
  if (!CURRENCY) CURRENCY = 'â‚¬'; // fallback ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ø§Ù†Ø© ÙØ§Ø±ØºØ©

  const storeName = STORE_DATA.store_name || 'Ù…ØªØ¬Ø±';
  const storeDescription = STORE_DATA.page_description || 'Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ØªÙƒØ§Ù…Ù„';

  // Ø¹Ù†ÙˆØ§Ù†/Ø§Ø³Ù…
  document.getElementById('store-name').textContent = storeName;
  document.getElementById('footer-store-name').textContent = storeName;
  document.getElementById('footer-store-name-bottom').textContent = storeName;
  document.title = storeName;

  // ÙˆØµÙ
  document.getElementById('footer-store-description').textContent = storeDescription;

  // Header phone (desktop)
  document.getElementById('store-phone').textContent = STORE_DATA.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';

  // About page
  const aboutPhoneEl = document.getElementById('about-phone'); if (aboutPhoneEl) aboutPhoneEl.textContent = STORE_DATA.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  const aboutWhatsappEl = document.getElementById('about-whatsapp'); if (aboutWhatsappEl) aboutWhatsappEl.textContent = STORE_DATA.whatsapp || STORE_DATA.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  const aboutEmailEl = document.getElementById('about-email'); if (aboutEmailEl) aboutEmailEl.textContent = STORE_DATA.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  const aboutHoursEl = document.getElementById('about-hours'); if (aboutHoursEl) aboutHoursEl.textContent = STORE_DATA.working_hours || '24/7';
  const aboutAddressEl = document.getElementById('about-address'); if (aboutAddressEl) aboutAddressEl.textContent = STORE_DATA.address || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  const aboutCurrencyEl = document.getElementById('about-currency'); if (aboutCurrencyEl) aboutCurrencyEl.textContent = CURRENCY;

  // Shipping
  const shippingText = STORE_DATA.shipping === true
    ? (STORE_DATA.shipping_price ? `Ø´Ø­Ù† Ø¨Ù…Ø¨Ù„Øº ${Number(STORE_DATA.shipping_price).toFixed(2)} ${CURRENCY}` : 'Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ')
    : 'Ù„Ø§ ÙŠØªÙˆÙØ± Ø´Ø­Ù†';
  const aboutShippingEl = document.getElementById('about-shipping'); if (aboutShippingEl) aboutShippingEl.textContent = shippingText;

  // Contact page
  document.getElementById('contact-phone-text').textContent = STORE_DATA.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  document.getElementById('contact-whatsapp-text').textContent = STORE_DATA.whatsapp || STORE_DATA.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  document.getElementById('contact-email-text').textContent = STORE_DATA.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  document.getElementById('contact-address-text').textContent = STORE_DATA.address || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  document.getElementById('working-hours-weekdays').textContent = STORE_DATA.working_hours || '24/7';
  document.getElementById('working-hours-delivery').textContent = (STORE_DATA.shipping === true) ? shippingText : 'Ù„Ø§ ÙŠØªÙˆÙØ± Ø´Ø­Ù†';
  const contactCurrencyEl = document.getElementById('contact-currency'); if (contactCurrencyEl) contactCurrencyEl.textContent = CURRENCY;

  // Footer
  document.getElementById('footer-phone').textContent = STORE_DATA.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  document.getElementById('footer-whatsapp').textContent = STORE_DATA.whatsapp || STORE_DATA.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  document.getElementById('footer-email').textContent = STORE_DATA.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  document.getElementById('footer-address').textContent = STORE_DATA.address || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
  document.getElementById('footer-hours').textContent = STORE_DATA.working_hours || '24/7';
  document.getElementById('footer-shipping').textContent = shippingText;
  document.getElementById('footer-currency').textContent = CURRENCY;

  // Social links
  setupSocialLinks();

  // Announcement from store config (if present)
  if (STORE_DATA.message && STORE_DATA.message.trim() !== ''){
    document.getElementById('announcement-bar').style.display = 'block';
    document.getElementById('announcement-text').textContent = STORE_DATA.message;
  }

  // âœ… Maps (About + Contact)
  applyMapsFromAddress(STORE_DATA.address || '');
}

function applyMapsFromAddress(address){
  const addr = (address || '').toString().trim();
  const aboutWrap = document.getElementById('about-map-wrap');
  const aboutMap = document.getElementById('about-map');
  const aboutHint = document.getElementById('about-map-hint');

  const contactWrap = document.getElementById('contact-map-wrap');
  const contactMap = document.getElementById('contact-map');
  const contactHint = document.getElementById('contact-map-hint');

  if (!addr){
    if (aboutWrap) aboutWrap.style.display = 'none';
    if (contactWrap) contactWrap.style.display = 'none';
    if (aboutHint) aboutHint.textContent = 'Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Sheets.';
    if (contactHint) contactHint.textContent = 'Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Sheets.';
    return;
  }

  const src = `https://www.google.com/maps?q=${encodeURIComponent(addr)}&output=embed`;
  if (aboutMap){ aboutMap.src = src; }
  if (contactMap){ contactMap.src = src; }
  if (aboutWrap) aboutWrap.style.display = 'block';
  if (contactWrap) contactWrap.style.display = 'block';
  if (aboutHint) aboutHint.textContent = '';
  if (contactHint) contactHint.textContent = '';
}

/* ========================================
   ğŸ“¡ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
   ======================================== */
async function fetchProducts(){
  const cached = cacheGet('products');
  if (cached && Array.isArray(cached.products)){
    productsData = cached.products;
    document.getElementById('loading').style.display = 'none';
    renderCategories(productsData);
    renderAllProducts(productsData);
    renderOfferProducts();
    return;
  }

  try{
    const res = await fetch(`${API_URL}?type=products&storeId=${STORE_ID}&_ts=${Date.now()}`);
    const json = await res.json();
    if (!json.success) throw new Error(json.message || 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');

    productsData = json.products || [];
    cacheSet('products', {products: productsData});

    document.getElementById('loading').style.display = 'none';

    if (productsData.length > 0){
      renderCategories(productsData);
      renderAllProducts(productsData);
      renderOfferProducts();
    } else {
      document.getElementById('products-grid').innerHTML = `
        <div class="empty-state" style="text-align:center; padding:3rem; color:var(--muted); grid-column:1 / -1;">
          <i class="fas fa-box-open" style="font-size:3rem;color:rgba(122,135,151,.25)"></i>
          <h3 style="margin-top:1rem; font-weight:900;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
          <p>Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
        </div>`;
    }
  }catch(e){
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', e);
    document.getElementById('loading').innerHTML = `
      <div style="max-width:720px;margin:0 auto;background:#fff;border-radius:16px;padding:16px;border:1px solid rgba(16,24,40,.08);box-shadow:var(--shadow)">
        Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.
      </div>`;
  }
}

/* ========================================
   ğŸ”§ ÙˆØ¸Ø§Ø¦Ù Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù†ÙØ³ Ù…Ù†Ø·Ù‚Ùƒ)
   ======================================== */
function checkBooleanValue(value){
  if (value === null || value === undefined) return false;
  if (typeof value === 'boolean') return value;
  const strValue = value.toString().toLowerCase().trim();
  return (strValue === 'true' || strValue === 'yes' || strValue === '1' || strValue === 'Ù†Ø¹Ù…' || strValue === 'âœ“' || strValue === 'âœ”' || strValue === 'ØµØ­ÙŠØ­' || strValue === 'ØµØ­');
}

function isProductActive(product){
  const v = product.product_active ?? product.productActive ?? product.active;
  return checkBooleanValue(v);
}

function hasOffer(product){
  const v = product.has_offer ?? product.hasOffer;
  return checkBooleanValue(v);
}

function parseDate(dateString){
  if (!dateString) return null;
  try{
    const s = dateString.toString().trim();
    // DD.MM.YYYY
    if (s.match(/^\d{1,2}\.\d{1,2}\.\d{4}$/)){
      const parts = s.split('.');
      return new Date(parts[2], parts[1] - 1, parts[0]);
    }
    // YYYY-MM-DD
    if (s.match(/^\d{4}-\d{1,2}-\d{1,2}$/)){
      const [y,m,d] = s.split('-').map(Number);
      return new Date(y, m-1, d);
    }
    return new Date(s);
  }catch(e){
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®:', dateString);
    return null;
  }
}

function isOfferActive(product){
  if (!hasOffer(product)) return false;

  const activeFlag =
    product.offer_aktive ?? product.offerAktive ??
    product.offer_active ?? product.offerActive;

  if (!checkBooleanValue(activeFlag)) return false;

  const now = new Date();
  const startDate = parseDate(product.offer_start_date ?? product.offerStartDate);
  const endDate   = parseDate(product.offer_end_date   ?? product.offerEndDate);

  if (startDate && now < startDate) return false;
  if (endDate && now > endDate) return false;

  return true;
}

function calculatePrice(product){
  const originalPrice = parseFloat(product.price) || 0;
  let finalPrice = originalPrice;
  let hasDiscount = false;
  let hasBundle = false;
  let discountPercent = 0;
  let bundleInfo = null;
  let bundleText = '';

  const offerTypeRaw = (product.offer_type ?? product.offerType ?? '').toString().toLowerCase();
  const percentRaw = Number(product.percent ?? product.offerPercent ?? 0);
  const bundleQtyRaw = Number(product.bundle_qty ?? product.bundleQty ?? 1);
  const bundlePriceRaw = Number(product.bundle_price ?? product.bundlePrice ?? originalPrice);

  if (hasOffer(product) && isOfferActive(product)){
    if (offerTypeRaw.includes('percent') || offerTypeRaw.includes('rabatt') || offerTypeRaw.includes('discount')){
      discountPercent = parseFloat(percentRaw) || 0;
      if (discountPercent > 0 && discountPercent <= 100){
        finalPrice = originalPrice - (originalPrice * discountPercent / 100);
        hasDiscount = true;
      }
    } else if (offerTypeRaw.includes('bundle')){
      const bundleQty = parseInt(bundleQtyRaw) || 1;
      const bundlePrice = parseFloat(bundlePriceRaw) || originalPrice;
      if (bundleQty > 1 && bundlePrice > 0){
        hasBundle = true;
        bundleInfo = { qty: bundleQty, price: bundlePrice, unitPrice: bundlePrice / bundleQty };
        bundleText = `${bundleQty} Ø¨Ù€ ${bundlePrice.toFixed(2)} ${CURRENCY}`;
      }
    }
  }

  return {
    originalPrice,
    finalPrice: parseFloat(finalPrice.toFixed(2)),
    hasDiscount,
    hasBundle,
    bundleInfo,
    discountPercent,
    bundleText
  };
}

function calculateCartItemPrice(item){
  let total = 0;
  if (item.hasBundle && item.bundleInfo){
    const bundles = Math.floor(item.qty / item.bundleInfo.qty);
    const remainder = item.qty % item.bundleInfo.qty;
    total = (bundles * item.bundleInfo.price) + (remainder * item.originalPrice);
  } else if (item.hasDiscount){
    total = item.finalPrice * item.qty;
  } else {
    total = item.originalPrice * item.qty;
  }
  return parseFloat(total.toFixed(2));
}

/* ========================================
   ğŸ–¼ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - UPDATED WITH DESCRIPTION TOGGLE
   ======================================== */
function productImageHTML(p){
  const url = (p.image || '').toString().trim();
  if (!url){
    return `
      <div class="placeholder-image">
        <div class="ph">Beispielbild<br><small>ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©</small></div>
      </div>
    `;
  }
  return `
    <img src="${url}"
      class="product-image"
      alt="${escapeHtml(p.name || '')}"
      onerror="this.outerHTML='<div class=&quot;placeholder-image&quot;><div class=&quot;ph&quot;>Beispielbild<br><small>ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©</small></div></div>'"
    />
  `;
}

function toggleDescription(element, productId) {
  const desc = element.closest('.product-info').querySelector('.product-desc');
  const toggleIcon = element.querySelector('.desc-toggle i');
  
  if (desc.classList.contains('expanded')) {
    desc.classList.remove('expanded');
    toggleIcon.className = 'fas fa-chevron-down';
  } else {
    desc.classList.add('expanded');
    toggleIcon.className = 'fas fa-chevron-up';
  }
}

function renderAllProducts(products){
  let filtered = products;
  if (activeCategory !== 'Ø§Ù„ÙƒÙ„'){
    filtered = products.filter(p => (p.category && p.category.trim() === activeCategory));
  }

  const activeProducts = [];
  const inactiveProducts = [];

  filtered.forEach(p => (isProductActive(p) ? activeProducts : inactiveProducts).push(p));

  renderGrid('products-grid', activeProducts, false);

  const inactiveContainer = document.getElementById('inactive-section');
  const toggleBtn = document.getElementById('inactive-toggle');

  if (inactiveProducts.length > 0){
    toggleBtn.style.display = 'block';
    renderGrid('inactive-grid', inactiveProducts, true);
  } else {
    toggleBtn.style.display = 'none';
    inactiveContainer.style.display = 'none';
  }
}

function renderGrid(containerId, products, isInactive){
  const grid = document.getElementById(containerId);

  if (products.length === 0 && !isInactive){
    grid.innerHTML = `
      <div class="empty-state" style="text-align:center; padding:3rem; color:var(--muted); grid-column:1 / -1;">
        <i class="fas fa-box-open" style="font-size:3rem;color:rgba(122,135,151,.25)"></i>
        <h3 style="margin-top:1rem; font-weight:900;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h3>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù†Ø´Ø·Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</p>
      </div>`;
    return;
  }
  if (products.length === 0 && isInactive){ grid.innerHTML = ''; return; }

  grid.innerHTML = '';

  products.forEach(p => {
    const pricing = calculatePrice(p);
    const isActive = isProductActive(p) && !isInactive;
    const isMobile = window.innerWidth <= 992;

    let priceHTML = '';
    let badgeHTML = '';

    if (pricing.hasDiscount){
      priceHTML = `
        <div class="price-wrapper">
          <span class="price-old">${pricing.originalPrice.toFixed(2)} ${CURRENCY}</span>
          <span class="price-new discount">${pricing.finalPrice.toFixed(2)} ${CURRENCY}</span>
        </div>`;
      badgeHTML = `<div class="discount-badge">${isMobile ? `${pricing.discountPercent}%` : `Ø®ØµÙ… ${pricing.discountPercent}%`}</div>`;
    } else if (pricing.hasBundle){
      priceHTML = `
        <div class="price-wrapper">
          <span class="price-old">${pricing.originalPrice.toFixed(2)} ${CURRENCY}</span>
          <span class="price-new bundle">${pricing.bundleInfo.unitPrice.toFixed(2)} ${CURRENCY}</span>
        </div>`;
      badgeHTML = `<div class="bundle-badge">${isMobile ? pricing.bundleText.replace(' Ø¨Ù€ ', '/') : pricing.bundleText}</div>`;
    } else {
      priceHTML = `
        <div class="price-wrapper">
          <span class="price-new">${pricing.originalPrice.toFixed(2)} ${CURRENCY}</span>
        </div>`;
    }

    const cardClass = isActive ? 'product-card' : 'product-card inactive';
    const inactiveBadge = !isActive ? '<div class="inactive-badge">ØºÙŠØ± Ù…ØªÙˆÙØ±</div>' : '';
    const btnState = isActive ? '' : 'disabled';
    const btnText = isActive ? (isMobile ? 'Ø£Ø¶Ù' : 'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©') : (isMobile ? 'Ù†ÙØ°' : 'Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©');
    const btnIcon = isActive ? 'fa-plus' : 'fa-times';
    const btnClick = isActive ? `onclick="addToCart('${escapeAttr(p.id)}', this)"` : '';

    const sizeValue = p.sizevalue || '';
    const sizeUnit = p.sizeunit || '';
    const sizeDisplay = (!isMobile && sizeValue && sizeUnit) ? `<div class="product-size"><i class="fas fa-weight-hanging"></i> Ø§Ù„Ø­Ø¬Ù…: ${escapeHtml(sizeValue)} ${escapeHtml(sizeUnit)}</div>` : '';

    const bundleInfoHTML = (!isMobile && pricing.hasBundle) ? `<div class="bundle-info">Ø¹Ø±Ø¶ Ø­Ø²Ù…Ø©: ${pricing.bundleText}</div>` : '';
    
    // Check if we're on mobile to decide whether to show description toggle
    const descToggleHTML = !isMobile ? `<span class="desc-toggle" onclick="toggleDescription(this, '${escapeAttr(p.id)}')"><i class="fas fa-chevron-down"></i></span>` : '';

    grid.innerHTML += `
      <div class="${cardClass}">
        <div class="product-image-container">
          ${productImageHTML(p)}
          <div class="product-badges">
            ${badgeHTML}
            ${inactiveBadge}
          </div>
        </div>

        <div class="product-info">
          <h3 class="product-title" onclick="${!isMobile ? `toggleDescription(this, '${escapeAttr(p.id)}')` : ''}">
            ${escapeHtml(p.name || '')}
            ${descToggleHTML}
          </h3>
          ${sizeDisplay}
          <p class="product-desc">${escapeHtml(p.description || '')}</p>
          ${bundleInfoHTML}

          <div class="price-container">
            ${priceHTML}
            <button class="add-btn" ${btnClick} ${btnState}>
              <i class="fas ${btnIcon}"></i> ${btnText}
            </button>
          </div>
        </div>
      </div>`;
  });
}

function renderOfferProducts(){
  const offersGrid = document.getElementById('offers-grid');
  const noOffers = document.getElementById('no-offers');

  if (!productsData || productsData.length === 0){
    offersGrid.innerHTML = '';
    noOffers.style.display = 'block';
    return;
  }

  const offerProducts = productsData.filter(p => isProductActive(p) && hasOffer(p) && isOfferActive(p));

  if (offerProducts.length === 0){
    offersGrid.innerHTML = '';
    noOffers.style.display = 'block';
    return;
  }

  noOffers.style.display = 'none';
  offersGrid.innerHTML = '';
  offerProducts.forEach(p => {
    const pricing = calculatePrice(p);
    const isMobile = window.innerWidth <= 992;

    let priceHTML = '';
    let badgeHTML = '';

    if (pricing.hasDiscount){
      priceHTML = `
        <div class="price-wrapper">
          <span class="price-old">${pricing.originalPrice.toFixed(2)} ${CURRENCY}</span>
          <span class="price-new discount">${pricing.finalPrice.toFixed(2)} ${CURRENCY}</span>
        </div>`;
      badgeHTML = `<div class="discount-badge">${isMobile ? `${pricing.discountPercent}%` : `Ø®ØµÙ… ${pricing.discountPercent}%`}</div>`;
    } else if (pricing.hasBundle){
      priceHTML = `
        <div class="price-wrapper">
          <span class="price-old">${pricing.originalPrice.toFixed(2)} ${CURRENCY}</span>
          <span class="price-new bundle">${pricing.bundleInfo.unitPrice.toFixed(2)} ${CURRENCY}</span>
        </div>`;
      badgeHTML = `<div class="bundle-badge">${isMobile ? pricing.bundleText.replace(' Ø¨Ù€ ', '/') : pricing.bundleText}</div>`;
    } else {
      // should not happen, but keep safe
      priceHTML = `<div class="price-wrapper"><span class="price-new">${pricing.originalPrice.toFixed(2)} ${CURRENCY}</span></div>`;
      badgeHTML = `<div class="discount-badge">${isMobile ? 'Ø¹Ø±Ø¶' : 'Ø¹Ø±Ø¶'}</div>`;
    }

    const sizeValue = p.sizevalue || '';
    const sizeUnit = p.sizeunit || '';
    const sizeDisplay = (!isMobile && sizeValue && sizeUnit) ? `<div class="product-size"><i class="fas fa-weight-hanging"></i> Ø§Ù„Ø­Ø¬Ù…: ${escapeHtml(sizeValue)} ${escapeHtml(sizeUnit)}</div>` : '';
    const bundleInfoHTML = (!isMobile && pricing.hasBundle) ? `<div class="bundle-info">Ø¹Ø±Ø¶ Ø­Ø²Ù…Ø©: ${pricing.bundleText}</div>` : '';
    
    // Check if we're on mobile
    const descToggleHTML = !isMobile ? `<span class="desc-toggle" onclick="toggleDescription(this, '${escapeAttr(p.id)}')"><i class="fas fa-chevron-down"></i></span>` : '';

    offersGrid.innerHTML += `
      <div class="product-card">
        <div class="product-image-container">
          ${productImageHTML(p)}
          <div class="product-badges">${badgeHTML}</div>
        </div>

        <div class="product-info">
          <h3 class="product-title" onclick="${!isMobile ? `toggleDescription(this, '${escapeAttr(p.id)}')` : ''}">
            ${escapeHtml(p.name || '')}
            ${descToggleHTML}
          </h3>
          ${sizeDisplay}
          <p class="product-desc">${escapeHtml(p.description || '')}</p>
          ${bundleInfoHTML}

          <div class="price-container">
            ${priceHTML}
            <button class="add-btn" onclick="addToCart('${escapeAttr(p.id)}', this)">
              <i class="fas fa-plus"></i> ${isMobile ? 'Ø£Ø¶Ù' : 'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©'}
            </button>
          </div>
        </div>
      </div>`;
  });
}

function renderCategories(products){
  const nav = document.getElementById('category-nav');
  const rawCategories = products.map(p => p.category).filter(c => c && c.trim() !== '');
  const uniqueCategories = (Array.isArray(categoriesData) && categoriesData.length) ? categoriesData : [...new Set(rawCategories)];

  if (uniqueCategories.length > 0){
    nav.style.display = 'flex';
    nav.innerHTML = '';

    const allBtn = document.createElement('button');
    allBtn.className = 'cat-btn active';
    allBtn.innerHTML = '<i class="fas fa-th-large"></i> Ø§Ù„ÙƒÙ„';
    allBtn.onclick = () => filterProducts('Ø§Ù„ÙƒÙ„', allBtn);
    nav.appendChild(allBtn);

    uniqueCategories.forEach(cat => {
      const btn = document.createElement('button');
      btn.className = 'cat-btn';
      btn.innerHTML = `<i class="fas fa-tag"></i> ${escapeHtml(cat)}`;
      btn.onclick = () => filterProducts(cat, btn);
      nav.appendChild(btn);
    });
  }
}

function filterProducts(category, btnElement){
  activeCategory = category;
  document.querySelectorAll('#category-nav .cat-btn').forEach(b => b.classList.remove('active'));
  if (btnElement) btnElement.classList.add('active');
  renderAllProducts(productsData);
}

function toggleInactive(){
  const section = document.getElementById('inactive-section');
  const btn = document.getElementById('toggle-inactive-text');

  if (section.style.display === 'none'){
    section.style.display = 'block';
    btn.textContent = 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø©';
  } else {
    section.style.display = 'none';
    btn.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·Ø©';
  }
}

/* ========================================
   ğŸ—ºï¸ Ø§Ù„ØªÙ†Ù‚Ù„
   ======================================== */
function initNavigation(){
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', function(e){
      e.preventDefault();
      const page = this.getAttribute('data-page');
      navigateToPage(page);
    });
  });

  document.querySelectorAll('footer a[data-page]').forEach(link => {
    link.addEventListener('click', function(e){
      e.preventDefault();
      const page = this.getAttribute('data-page');
      navigateToPage(page);
    });
  });

  document.getElementById('mobileToggle').addEventListener('click', function(){
    document.getElementById('navMenu').classList.toggle('active');
    this.innerHTML = document.getElementById('navMenu').classList.contains('active')
      ? '<i class="fas fa-times"></i>'
      : '<i class="fas fa-bars"></i>';
  });

  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', function(){
      document.getElementById('navMenu').classList.remove('active');
      document.getElementById('mobileToggle').innerHTML = '<i class="fas fa-bars"></i>';
    });
  });
}

function navigateToPage(page){
  document.querySelectorAll('.nav-link').forEach(link => {
    link.classList.toggle('active', link.getAttribute('data-page') === page);
  });

  showPage(page);
  currentPage = page;

  if (page === 'offers') renderOfferProducts();
}

function showPage(page){
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const pageElement = document.getElementById(`${page}-page`);
  if (pageElement) pageElement.classList.add('active');
  closeCart();
}

/* ========================================
   ğŸ›’ Ø§Ù„Ø³Ù„Ø© - COMPLETELY REVISED
   ======================================== */
function addToCart(id, btn){
  const product = productsData.find(p => String(p.id) === String(id));
  if (!product || !isProductActive(product)) return;

  const pricing = calculatePrice(product);
  const existingItem = cart.find(item => String(item.id) === String(id));

  if (existingItem){
    existingItem.qty++;
  } else {
    cart.push({
      id: product.id,
      name: product.name,
      originalPrice: pricing.originalPrice,
      finalPrice: pricing.finalPrice,
      hasDiscount: pricing.hasDiscount,
      hasBundle: pricing.hasBundle,
      bundleInfo: pricing.bundleInfo,
      bundleText: pricing.bundleText,
      qty: 1,
      sizeValue: product.sizevalue,
      sizeUnit: product.sizeunit
    });
  }

  saveCart();

  if (btn){
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-check"></i> ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©';
    btn.style.background = 'linear-gradient(135deg, var(--accent), var(--accent-light))';
    setTimeout(() => {
      btn.innerHTML = originalHTML;
      btn.style.background = '';
    }, 1500);
  }

  showAlert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª', 'success');
}

function saveCart(){
  try{ localStorage.setItem(cartStorageKey(), JSON.stringify(cart)); }catch(e){}
  updateCartCount();
  renderCartItems();
}

function updateCartCount(){
  const totalItems = cart.reduce((sum, i) => sum + (i.qty || 0), 0);
  document.getElementById('cart-badge').textContent = totalItems;

  if (totalItems === 0){
    const empty = document.querySelector('.cart-empty');
    if (empty) empty.style.display = 'flex';
    document.getElementById('cart-summary').style.display = 'none';
  } else {
    const empty = document.querySelector('.cart-empty');
    if (empty) empty.style.display = 'none';
    document.getElementById('cart-summary').style.display = 'block';
  }
}

// FIXED: These functions now work properly
function changeQty(id, delta){
  const item = cart.find(i => String(i.id) === String(id));
  if (item){
    item.qty += delta;
    if (item.qty <= 0) cart = cart.filter(i => String(i.id) !== String(id));
    saveCart();
  }
}

function removeFromCart(id){
  cart = cart.filter(i => String(i.id) !== String(id));
  saveCart();
}

function renderCartItems(){
  const container = document.getElementById('cart-items');

  if (cart.length === 0){
    container.innerHTML = `
      <div class="cart-empty">
        <i class="fas fa-shopping-basket"></i>
        <p>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙØ§Ø±ØºØ©</p>
      </div>`;
    document.getElementById('cart-summary').style.display = 'none';
    return;
  }

  let subtotal = 0;

  container.innerHTML = cart.map(item => {
    const itemTotal = calculateCartItemPrice(item);
    subtotal += itemTotal;

    let priceDisplay = '';

    if (item.hasBundle && item.bundleInfo){
      const bundles = Math.floor(item.qty / item.bundleInfo.qty);
      if (bundles > 0){
        priceDisplay = `
          <div class="item-price">
            <span class="old-price">${item.originalPrice.toFixed(2)} ${CURRENCY}</span>
            ${item.bundleInfo.unitPrice.toFixed(2)} ${CURRENCY}
            <div class="bundle-note">(${item.bundleText})</div>
          </div>`;
      } else {
        priceDisplay = `
          <div class="item-price">
            ${item.originalPrice.toFixed(2)} ${CURRENCY}
            <div class="bundle-note">(Ø§Ù„Ø¹Ø±Ø¶ ÙŠØ¨Ø¯Ø£ Ø¹Ù†Ø¯ ${item.bundleInfo.qty})</div>
          </div>`;
      }
    } else if (item.hasDiscount){
      priceDisplay = `
        <div class="item-price">
          <span class="old-price">${item.originalPrice.toFixed(2)} ${CURRENCY}</span>
          ${item.finalPrice.toFixed(2)} ${CURRENCY}
        </div>`;
    } else {
      priceDisplay = `<div class="item-price">${item.originalPrice.toFixed(2)} ${CURRENCY}</div>`;
    }

    const sizeInfo = (item.sizeValue && item.sizeUnit) ? `<div class="item-size">${escapeHtml(item.sizeValue)} ${escapeHtml(item.sizeUnit)}</div>` : '';

    return `
      <div class="cart-item">
        <div class="item-info">
          <div class="item-name">${escapeHtml(item.name || '')}</div>
          ${sizeInfo}
          ${priceDisplay}
          <div style="color: var(--accent-dark); font-weight: 900; margin-top: 6px;">
            Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${itemTotal.toFixed(2)} ${CURRENCY}
          </div>
        </div>
        <div class="item-controls">
          <button onclick="changeQty('${escapeAttr(item.id)}', -1)">-</button>
          <span class="item-qty">${item.qty}</span>
          <button onclick="changeQty('${escapeAttr(item.id)}', 1)">+</button>
          <button class="remove-item-btn" onclick="removeFromCart('${escapeAttr(item.id)}')">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>`;
  }).join('');

  const shippingPrice = (STORE_DATA.shipping === true) ? (parseFloat(STORE_DATA.shipping_price) || 0) : 0;
  const total = subtotal + shippingPrice;

  document.getElementById('cart-subtotal').textContent = subtotal.toFixed(2) + ' ' + CURRENCY;
  document.getElementById('cart-shipping').textContent = shippingPrice > 0 ? shippingPrice.toFixed(2) + ' ' + CURRENCY : 'Ù…Ø¬Ø§Ù†ÙŠ';
  document.getElementById('cart-total').textContent = total.toFixed(2) + ' ' + CURRENCY;
}

function openCart(){
  renderCartItems();
  document.getElementById('cartModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeCart(){
  document.getElementById('cartModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

// Fix for closing modal when clicking outside
document.getElementById('cartModal').addEventListener('click', (e) => {
  if (e.target.id === 'cartModal') closeCart();
});

/* ========================================
   ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
   ======================================== */
function checkout(){
  const name = document.getElementById('cust-name').value.trim();
  const phone = document.getElementById('cust-phone').value.trim();
  const address = document.getElementById('cust-address').value.trim();

  if (!name || !phone || cart.length === 0){
    showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©', 'error');
    return;
  }

  const shippingPrice = (STORE_DATA.shipping === true) ? (parseFloat(STORE_DATA.shipping_price) || 0) : 0;

  let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${STORE_DATA.store_name || ''}*\n`;
  msg += `========================\n`;
  msg += `ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\n`;
  msg += `ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\n`;
  msg += `ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}\n`;
  msg += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-SA')}\n`;
  msg += `â° Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleTimeString('ar-SA', {hour: '2-digit', minute:'2-digit'})}\n`;
  msg += `========================\n`;
  msg += `ğŸ“‹ *Ø§Ù„Ø·Ù„Ø¨Ø§Øª:*\n\n`;

  let subtotal = 0;
  let savedAmount = 0;

  cart.forEach((item, index) => {
    const itemTotal = calculateCartItemPrice(item);
    subtotal += itemTotal;

    const originalTotal = item.originalPrice * item.qty;
    savedAmount += (originalTotal - itemTotal);

    msg += `*${index + 1}. ${item.name}*\n`;

    if (item.sizeValue && item.sizeUnit){
      msg += `   Ø§Ù„Ø­Ø¬Ù…: ${item.sizeValue} ${item.sizeUnit}\n`;
    }

    msg += `   Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty}\n`;

    if (item.hasBundle && item.bundleInfo){
      const bundles = Math.floor(item.qty / item.bundleInfo.qty);
      if (bundles > 0){
        msg += `   Ø§Ù„Ø³Ø¹Ø±: ${item.bundleInfo.unitPrice.toFixed(2)} ${CURRENCY} (${item.bundleText})\n`;
      } else {
        msg += `   Ø§Ù„Ø³Ø¹Ø±: ${item.originalPrice.toFixed(2)} ${CURRENCY} (Ø§Ù„Ø¹Ø±Ø¶ ÙŠØ¨Ø¯Ø£ Ø¹Ù†Ø¯ ${item.bundleInfo.qty})\n`;
      }
    } else if (item.hasDiscount){
      msg += `   Ø§Ù„Ø³Ø¹Ø±: ${item.finalPrice.toFixed(2)} ${CURRENCY} (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ${item.originalPrice.toFixed(2)} ${CURRENCY})\n`;
    } else {
      msg += `   Ø§Ù„Ø³Ø¹Ø±: ${item.originalPrice.toFixed(2)} ${CURRENCY}\n`;
    }

    msg += `   Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${itemTotal.toFixed(2)} ${CURRENCY}\n\n`;
  });

  msg += `========================\n`;
  if (savedAmount > 0) msg += `ğŸ‰ *Ù„Ù‚Ø¯ ÙˆÙØ±Øª: ${savedAmount.toFixed(2)} ${CURRENCY}*\n`;
  msg += `ğŸ“¦ *Ø§Ù„Ø´Ø­Ù†: ${shippingPrice > 0 ? shippingPrice.toFixed(2) + ' ' + CURRENCY : 'Ù…Ø¬Ø§Ù†ÙŠ'}*\n`;
  msg += `ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${(subtotal + shippingPrice).toFixed(2)} ${CURRENCY}*\n`;
  msg += `========================\n`;
  msg += `Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… Ø¨Ù€ ${STORE_DATA.store_name || ''}!`;

  const whatsappNumber = (STORE_DATA.whatsapp || STORE_DATA.phone || '').toString().trim();
  if (whatsappNumber){
    window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`, '_blank');

    cart = [];
    saveCart();
    closeCart();

    document.getElementById('cust-name').value = '';
    document.getElementById('cust-phone').value = '';
    document.getElementById('cust-address').value = '';

    showAlert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'success');
  } else {
    showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ù„Ù„Ù…ØªØ¬Ø±', 'error');
  }
}

/* ========================================
   ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„
   ======================================== */
function setupSocialLinks(){
  const socialLinksContainer = document.getElementById('social-links');
  const footerSocialLinks = document.getElementById('footer-social-links');

  const socialLinks = [];
  if (STORE_DATA.facebook) socialLinks.push({icon: 'fab fa-facebook-f', url: STORE_DATA.facebook, class: 'facebook'});
  if (STORE_DATA.instagram) socialLinks.push({icon: 'fab fa-instagram', url: STORE_DATA.instagram, class: 'instagram'});
  if (STORE_DATA.tiktok) socialLinks.push({icon: 'fab fa-tiktok', url: STORE_DATA.tiktok, class: 'tiktok'});

  const socialHTML = socialLinks.map(link =>
    `<a href="${link.url}" target="_blank" rel="noopener noreferrer" class="${link.class}"><i class="${link.icon}"></i></a>`
  ).join('');

  socialLinksContainer.innerHTML = socialHTML;
  footerSocialLinks.innerHTML = socialHTML;
}

/* ========================================
   â³ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶ (UI ÙÙ‚Ø·)
   ======================================== */
function initOfferTimer(){
  const endDate = new Date();
  endDate.setDate(endDate.getDate() + 7);

  function updateTimer(){
    const now = new Date().getTime();
    const distance = endDate - now;

    if (distance < 0){
      document.querySelector('.timer').innerHTML = '<div>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¹Ø±ÙˆØ¶</div>';
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    document.getElementById('days').textContent = String(days).padStart(2,'0');
    document.getElementById('hours').textContent = String(hours).padStart(2,'0');
    document.getElementById('minutes').textContent = String(minutes).padStart(2,'0');
    document.getElementById('seconds').textContent = String(seconds).padStart(2,'0');
  }

  updateTimer();
  setInterval(updateTimer, 1000);
}

/* ========================================
   ğŸ”” Alerts
   ======================================== */
function showAlert(message, type='success'){
  const existing = document.querySelector('.notification');
  if (existing) existing.remove();

  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
    <span>${escapeHtml(message)}</span>
  `;
  notification.style.cssText = `
    position: fixed;
    top: 118px;
    left: 50%;
    transform: translateX(-50%);
    background: ${type === 'success' ? 'linear-gradient(135deg, var(--accent), var(--accent-light))' : 'linear-gradient(135deg, var(--danger), var(--danger-dark))'};
    color: white;
    padding: 1rem 1.3rem;
    border-radius: 14px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    z-index: 3000;
    max-width: 92%;
    width: max-content;
    font-weight: 900;
  `;
  document.body.appendChild(notification);

  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(-50%) translateY(-10px)';
    notification.style.transition = 'all .25s ease';
    setTimeout(() => notification.remove(), 250);
  }, 2600);
}

/* ========================================
   ğŸ§¼ Escape helpers
   ======================================== */
function escapeHtml(s){
  return String(s ?? '')
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#039;");
}
function escapeAttr(s){
  return escapeHtml(s).replaceAll('"','&quot;');
}
</script>
</body>
</html>